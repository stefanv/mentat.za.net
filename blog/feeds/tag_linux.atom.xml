<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Stéfan van der Walt - linux</title><link href="https://mentat.za.net/blog/" rel="alternate"></link><link href="https://mentat.za.net/blog/feeds/tag_linux.atom.xml" rel="self"></link><id>https://mentat.za.net/blog/</id><updated>2015-01-24T00:00:00-08:00</updated><entry><title>VPN-only access to the internet</title><link href="https://mentat.za.net/blog/2015/01/24/vpn-only-internet/" rel="alternate"></link><published>2015-01-24T00:00:00-08:00</published><updated>2015-01-24T00:00:00-08:00</updated><author><name>Stefan van der Walt</name></author><id>tag:mentat.za.net,2015-01-24:/blog/2015/01/24/vpn-only-internet/</id><summary type="html">&lt;p&gt;tl;dr A firewall setup that allows traffic to leave &lt;em&gt;only&lt;/em&gt; via the VPN.
&lt;/p&gt;
&lt;p&gt;A few days ago, I noticed that my outbound email wasn&amp;rsquo;t being
delivered&amp;mdash;it seems as if my ISP blocks access to some outbound ports.
An easy workaround is to route traffic through the work …&lt;/p&gt;</summary><content type="html">&lt;p&gt;tl;dr A firewall setup that allows traffic to leave &lt;em&gt;only&lt;/em&gt; via the VPN.
&lt;/p&gt;
&lt;p&gt;A few days ago, I noticed that my outbound email wasn&amp;rsquo;t being
delivered&amp;mdash;it seems as if my ISP blocks access to some outbound ports.
An easy workaround is to route traffic through the work VPN, but
knowing myself I&amp;rsquo;d forget to switch it on, leaving my outbound mail
stranded.&lt;/p&gt;
&lt;p&gt;I needed a way of blocking &lt;em&gt;any&lt;/em&gt; access to the internet, unless it was
leaving through the VPN (since I was sure I&amp;rsquo;d notice &lt;em&gt;that&lt;/em&gt; pretty
quickly).&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;d have preferred to use firewalld, which is neatly integrated into
Ubuntu, but as of 01/24/2015 it 
&lt;a href="https://lists.fedorahosted.org/pipermail/firewalld-users/2014-October/000250.html"&gt;doesn&amp;rsquo;t allow filtering outbound traffic&lt;/a&gt;&lt;sup id="fnref:firewalld_direct_zones"&gt;&lt;a class="footnote-ref" href="#fn:firewalld_direct_zones"&gt;1&lt;/a&gt;&lt;/sup&gt;. What
follows, then, is a simple approach implementing the following rule:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Block wifi traffic unless it goes to either the local
network or the VPN.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Create a script (I called it &lt;code&gt;~/scripts/fw-up&lt;/code&gt;) that sets up the
firewall:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="c1"&gt;# Clear any existing rules&lt;/span&gt;
iptables -F

&lt;span class="c1"&gt;# Allow outbound DNS&lt;/span&gt;
iptables -A OUTPUT -p udp --dport &lt;span class="m"&gt;53&lt;/span&gt; -j ACCEPT
iptables -A INPUT -p udp --sport &lt;span class="m"&gt;53&lt;/span&gt; -j ACCEPT

&lt;span class="c1"&gt;# Allow TCP access to the work VPN&lt;/span&gt;
&lt;span class="c1"&gt;# Replace X.Y below with your VPN address range&lt;/span&gt;
iptables -A OUTPUT -p tcp -d X.Y.0.0/16 -o wlan1 -j ACCEPT

&lt;span class="c1"&gt;# Allow any traffic destined for the vpn to go out&lt;/span&gt;
iptables -A OUTPUT -o vpn0 -j ACCEPT

&lt;span class="c1"&gt;# Allow local traffic&lt;/span&gt;
iptables -A OUTPUT -p tcp -o wlan1 -d &lt;span class="m"&gt;10&lt;/span&gt;.0.0.0/8 -j ACCEPT
iptables -A OUTPUT -p tcp -o wlan1 -d &lt;span class="m"&gt;172&lt;/span&gt;.16.0.0/12 -j ACCEPT
iptables -A OUTPUT -p tcp -o wlan1 -d &lt;span class="m"&gt;192&lt;/span&gt;.168.0.0/16 -j ACCEPT

&lt;span class="c1"&gt;# Drop everything else on the wifi&lt;/span&gt;
iptables -A OUTPUT -p tcp -o wlan1 -j DROP
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Make sure the script is set to executable (&lt;code&gt;chmod +x fw-up&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Add a symlink to &lt;code&gt;if-up.d&lt;/code&gt; to ensure that the firewall gets built
whenever the network is reconfigured:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;sudo&lt;/span&gt; &lt;span class="nv"&gt;ln&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt; &lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="nv"&gt;scripts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;fw&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;up&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;network&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;up&lt;/span&gt;.&lt;span class="nv"&gt;d&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;iptables&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, whenever you connect to a wifi hotspot, internet traffic will be
blocked until you fire up your VPN.  If, on occasion, you need to work
without the VPN, simply raze the firewall:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; Typically, you wouldn&amp;rsquo;t want the firewall to go up when
  connecting to the wireless at work, so I added the following conditional
  in the &lt;code&gt;fw-up&lt;/code&gt; script:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;F&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; [[ `&lt;span class="nv"&gt;iwgetid&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;r&lt;/span&gt;` &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;WorkSSID&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; ]]&lt;span class="c1"&gt;; then&lt;/span&gt;
   # &lt;span class="nv"&gt;Firewall&lt;/span&gt; &lt;span class="nv"&gt;rules&lt;/span&gt; &lt;span class="nv"&gt;go&lt;/span&gt; &lt;span class="nv"&gt;here&lt;/span&gt;
   ...
&lt;span class="nv"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="footnote"&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id="fn:firewalld_direct_zones"&gt;
&lt;p&gt;The idea would be to set up a zone, say
&lt;code&gt;vpn_only&lt;/code&gt;, and to assign your home wifi SSID to it.  A direct rule that
blocks any non-VPN traffic can then be added to the new zone (this
should be possible soon, and is on the firewalld
&lt;a href="https://git.fedorahosted.org/cgit/firewalld.git/tree/TODO"&gt;TODO list&lt;/a&gt;).&amp;#160;&lt;a class="footnote-backref" href="#fnref:firewalld_direct_zones" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content><category term="linux"></category></entry><entry><title>Adobe's new free font: Source Code Pro</title><link href="https://mentat.za.net/blog/2012/09/26/consolas-vs-source-code-pro/" rel="alternate"></link><published>2012-09-26T11:49:00-07:00</published><updated>2012-09-26T11:49:00-07:00</updated><author><name>Stefan van der Walt</name></author><id>tag:mentat.za.net,2012-09-26:/blog/2012/09/26/consolas-vs-source-code-pro/</id><summary type="html">&lt;p&gt;Adobe yesterday
&lt;a href="http://blogs.adobe.com/typblography/2012/09/source-code-pro.html"&gt;released its free and open source Type family, Source Code Pro&lt;/a&gt;,
which includes an eye-pleasing monospace font  ideally suited for coding.
In the past, and at the recommendation of &lt;a href="http://blog.fperez.org/"&gt;Fernando Perez&lt;/a&gt;, I&amp;rsquo;ve
used the beautiful (but non-free) &lt;a href="http://www.microsoft.com/en-us/download/details.aspx?id=17879"&gt;Consolas by Microsoft&lt;/a&gt;; now,
which is best?&lt;/p&gt;
&lt;p&gt;To install on …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Adobe yesterday
&lt;a href="http://blogs.adobe.com/typblography/2012/09/source-code-pro.html"&gt;released its free and open source Type family, Source Code Pro&lt;/a&gt;,
which includes an eye-pleasing monospace font  ideally suited for coding.
In the past, and at the recommendation of &lt;a href="http://blog.fperez.org/"&gt;Fernando Perez&lt;/a&gt;, I&amp;rsquo;ve
used the beautiful (but non-free) &lt;a href="http://www.microsoft.com/en-us/download/details.aspx?id=17879"&gt;Consolas by Microsoft&lt;/a&gt;; now,
which is best?&lt;/p&gt;
&lt;p&gt;To install on Linux:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://github.com/adobe-fonts/source-sans-pro/releases/tag/variable-fonts"&gt;Grab the font&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Copy the files to &lt;code&gt;~/.fonts&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;fc-cache -f -v&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The font should now be available for selection in apps such as Firefox, Gnome
Terminal, etc.  To make it the default font in Emacs::&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;set-default-font&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Source Code Pro&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here&amp;rsquo;s a comparison of Consolas (left) and Source Code Pro (right):&lt;/p&gt;
&lt;p&gt;&lt;img alt="Comparison: Consolas vs Source Code Pro" src="https://mentat.za.net/blog/images/consolas_vs_source_code_pro.png" /&gt;&lt;/p&gt;
&lt;p&gt;Comments also on &lt;a href="https://plus.google.com/104831275312843762750/posts/Ju6Ns8Dtuik"&gt;Google+&lt;/a&gt;.&lt;/p&gt;</content><category term="coding"></category><category term="emacs"></category><category term="linux"></category></entry></feed>