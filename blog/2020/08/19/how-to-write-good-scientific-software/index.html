<!DOCTYPE html>
<html lang="en-us">
    <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Where I discuss social, mechanical, and scholarly disciplines required for writing good scientific software.">

  <title>How to Write Good Scientific Software &middot; Stéfan&#39;s blog</title>

  
  <link rel="stylesheet" href="/blog/css/style.css">
  <link rel="stylesheet" href="/blog/css/fonts.css">
  <link rel="stylesheet" href="/blog/custom.css">
  
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Stéfan&#39;s blog" />

  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
    document.querySelectorAll("mjx-container").forEach(function(x){
      x.parentElement.classList += 'has-jax'})
  });
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/blog/">
					<h2 class="nav-title">Stéfan&#39;s blog</h2>
				</a>
				<ul>
    <li><a href="https://mentat.za.net">mentat.za.net</a></li>
    <li><a href="/blog/atom.xml">Atom / RSS feed</a></li>
</ul>

			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
</div>

		<h1 class="post-title">How to Write Good Scientific Software</h1>

<div class="post-date">
  
    August 19, 2020
  
</div>

<div class="post-tags">
  
    <div class="post-tag">
      <a href=/blog/tags/science>
        #science
      </a>
    </div>
  
    <div class="post-tag">
      <a href=/blog/tags/software>
        #software
      </a>
    </div>
  
    <div class="post-tag">
      <a href=/blog/tags/coding>
        #coding
      </a>
    </div>
  
</div>


		

		<p><em>This is a lightly edited transcript of a talk I delivered at MLSS South Africa on 16 January 2019.</em></p>
<p>In this post, I will define scientific software, describe how it is
different from other types of software, and discuss the social,
mechanical, and scholarly disciplines required for making it the best
it can be.</p>
<p>Upfront, I should note that these are all rough guidelines, but that
the context in which software is developed and used will affect the
extent to which they apply.  I make some generalizations to get my
point across.</p>
<h2 id="what-is-scientific-software">What is Scientific Software?</h2>
<p>Scientific software is typically computational in nature, and aids us
in our understanding of the world, often by processing observational
measurements.  Because scientific software aims to uncover <em>truths</em>,
<strong>accuracy</strong> is of paramount importance.  Of course, accuracy is
important in many industrial applications too&mdash;you do not want a
parcel delivered to the wrong address, or an email sent to the wrong
recipient&mdash;but in science errors invariably invalidate the work.</p>
<p>Here, I consider a subset of scientific software: that which is
written to aid in reproducibility.  This software has to be
<strong>reusable</strong><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>&mdash;particularly by those who did not write the software.
Even if reproducibility is not explicitly targeted, eventually most
scientific codes become associated with research outputs, such as
published papers.  At this point, ideally, the software should be open
for inspection, so that the science can be verified.  The vast
majority of research code has <em>not</em> historically fallen into this
category<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>, but I would argue that there are systematic changes underway
that will place more and more emphasis on openness.</p>
<h2 id="purpose">Purpose</h2>
<p>We write software for different purposes, and that changes the amount
of rigor applied.  Just as you may make some initial calculations on
a napkin, code is sometimes used to improve your understanding of a
problem, without any intent of using that code in future scenarios.</p>
<p>Apart from this type of &ldquo;scratch&rdquo; code, in increasing levels of
maturity we have: experimental code for private use, experimental code
that will be published, and algorithmic or infrastructure code with an
eye towards reusability.</p>
<p>I would argue that the first type&mdash;experimental code that never
leaves the room&mdash;is to be avoided at all cost.  This code cannot be
verified, and is in some sense no better than a black box that takes
some arguments and spits out an answer.  Is it a good answer that
reflects an underlying truth?  There is no way for anyone on the
outside to tell.</p>
<p>Experimental code should be tracked, just as you would fastidiously
keep a lab notebook in a chemical laboratory.</p>
<p>Now, let us examine the mechanisms we can use to improve the quality of
our software.  I want to start with a higher-level concept: that of
the social environment in which you develop software, and then move on
to more specific technical mechanisms.</p>
<h2 id="social-software">Social Software</h2>
<blockquote>
<p>One day, while I was a postdoc at Berkeley&rsquo;s Helen Wills
Neuroscience Institute, I walked into my office to find the
DiPy&mdash;that is, Diffusion Imaging in Python&mdash;team, busy finalizing
their new API design after an entire day&rsquo;s work.</p>
<p>I happened to be implementing identical functionality for my research, not realizing
that their library covered similar ground.  So, curious&mdash;and excited about the
prospect of being able to collaborate and leverage their
work&mdash;I started asking them about their new design, with my own use
case in mind.</p>
<p>It soon became clear that the software would not yet be able to address
my needs.  To the team&rsquo;s credit, despite some tired and
exasperated looks, they worked with me for the rest of the weekend
to refine their design until we had a general enough
interface that addressed all of our needs.</p>
<p>For the next two years, I worked very closely with this team,
helping them build out the package.  That software&mdash;which serves a
niche purpose in MRI&mdash;now has more than 450 citations.</p>
</blockquote>
<p>The takeaway for me was that, here, an extra pair of eyes made a
difference to the general utility of that software, and because of the
newly discovered synergy the development team grew, which in turn led
to many further hours of productive collaboration.</p>
<p>There is a large and ever-growing volume of research that shows the
advantages of group work.  For example, about an April 2006 <a href="https://www.apa.org/news/press/releases/2006/04/group.aspx">article in
the Journal of Personality and Social Psychology</a>, author Patrick
Laughlin from the University of Illinois says:</p>
<blockquote>
<p>&ldquo;We found that groups of size three, four, and five outperformed the
best individuals and attribute this performance to the ability of
people to work together to generate and adopt correct responses,
reject erroneous responses, and effectively process information.&rdquo;</p>
</blockquote>
<p>This emphasizes the quality of work a team can do.  Other similar
experiments compare, e.g., teams of students against their professors.</p>
<p>For a team to work well, however, it has to have certain qualities,
such as the right size and culture.</p>
<p>Jeff Sutherland, the co-inventor of SCRUM and co-author of the Agile
Manifesto, said at the Global Scrum Gathering 2017 that he believed
the optimal team size is 5.</p>
<p>But he also observe something remarkable<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>: that while
individual developers different in productivity with a ratio of as
much as 1:10, the difference can be orders of magnitude larger when it
comes to teams.</p>
<p>In 2012, Google launched Project Aristotle to determine what makes a
good team successful.  <a href="https://www.nytimes.com/2016/02/28/magazine/what-google-learned-from-its-quest-to-build-the-perfect-team.html?smid=pl-share">One of their key findings</a> was that group norms
are a key to success.  In other words, it makes a difference when team
members feel comfortable enough to take risks, make mistakes, and
voice their opinions.</p>
<p>There are also some further straightforward connections with teams and
better work:</p>
<ul>
<li>Two pairs of eyes are better than one&mdash;you can help one another find
flaws in your work.  Having other people <em>look</em> at your code (we
typically call this &ldquo;reviewing the code&rdquo;), makes it better.  For
open source libraries such as NumPy or scikit-image, it is not
atypical to see many tens of comments on any proposed patch.</li>
<li>As illustrated in the story above, your software is likely to have
wider application when it serves multiple people.</li>
<li>One team member may have insights the others don&rsquo;t.  E.g., they may
have some esoteric piece of knowledge, such as a better
interpolation scheme, a more stable algorithm, a better type of
regularization, or know a common failure mode of a certain neural network
structure.  Or, they may simply have a creative insight in the right
moment.  It is not so much about having the smartest or most
well-read team-members, as it is about creating intellectual
diversity within the team.</li>
</ul>
<p>In summary: find good and varied collaborators; your software will be
better because of it.</p>
<h2 id="technical-mechanisms-for-higher-quality-software">Technical Mechanisms for Higher Quality Software</h2>
<p>We now turn to more straightforward technical mechanisms, techniques,
and disciplines for improving the quality of your software.</p>
<blockquote>
<p>While working on a large open source project, we had a collaborator
who did not &ldquo;believe&rdquo; in testing.  That person also happened to be a
very talented programmer; still, I made a point of writing a test for
each piece of functionality they included.  Invariably, almost every
single contribution performed incorrectly on some corner case of the
data.</p>
<p>I knew at this point already that almost all the code I wrote was
flawed in some way, and that it only improved through iterative
refinement.  But it was an eye-opener to see that the best
programmers still made mistakes&mdash;and frequently.</p>
<p>Just like when you drive a car, you have certain blind spots while
programming.  And just like you check that blind spot on the road,
there are techniques we can use to make software development safer.</p>
</blockquote>
<p>Let me highlight a few of those mechanisms:</p>
<h3 id="test-your-software">Test your software</h3>
<p>At a very minimum, your software has to be run, frequently.  This does
not guarantee correct results, but at least allows you to go back and
re-run earlier steps of an analysis, as needed.  You&rsquo;d be surprised
how many researchers are stuck in a situation where they cannot
explore new ideas, because parts of their pipelines are stuck in an unrunnable
state. This is bad news: bad for your research, bad for reproducibility, and
bad for any papers that rely on these stagnant results.</p>
<p>Ideally, however, your code will be tested thoroughly.  While, or
immediately after, writing code, you will examine corner cases,
generate (by hand if needed) test data, and compare output against
pre-calculated results.  The formula is simple: if I execute <code>f(x)</code>,
do I get <code>y</code> as expected?</p>
<p>Testing is my primary concern around Jupyter notebooks for serious
science.  They <em>can</em> be tested, but it is hard, and the mechanisms are
not widely available.  They also encourage the use of global state,
instead of functions.  As such, I strongly discourage my students from
using them other than for scratch experiments, or as a by-product of
research to allow others to explore data and results.</p>
<p>To automate your tests, you may make use of continuous integration
systems such as Travis-CI, Azure Pipelines, et cetera.
(See, e.g.,
<a href="https://github.com/scikit-image/scikit-image/pull/3584">PR #3584 from NumPy</a>,
and its <a href="https://travis-ci.org/scikit-image/scikit-image/builds/465090731">test results on Travis-CI</a>.)</p>
<h3 id="track-your-progress">Track your progress</h3>
<p>Using a revision control system is a must, and I recommend Git.  This
lets you track the history of your software as it evolves, reduces the
need to keep hundreds of backup copies, and allows other developers to
take part in development.  See revision control as the equivalent of
your lab notebook, but for your software.  You&rsquo;ll never need to worry
about lost code again, and your stress levels the day before
publishing will thank you for it.</p>
<p>In &ldquo;The Toyota Way: 14 Principles From The World&rsquo;s Greatest
Manufacturer&rdquo;, Jeffrey Liker describes their 5S program for <em>effective</em>
and <em>productive</em> workspaces.  Three of these are: Sort, Straighten, and
Shine.  That is, sort out unneeded items, have a place for everything,
and keep your workspace clean.  Git provides the software tools to do
this.</p>
<h3 id="document-your-code">Document your code</h3>
<p>Your code may never see another pair of eyes, but even for your own
benefit: document your code.  I suggest identifying a documentation
template, such as <a href="https://numpydoc.readthedocs.io/en/latest/format.html#docstring-standard">the one we use for the NumPy project</a>.  Here, we
decide beforehand the types of things that should be documented, so
that each function has the same information.  <a href="https://github.com/numpy/numpy/blob/master/numpy/linalg/linalg.py#L328">For example</a>, you can
describe: the intent of the function, input parameters, return values,
usage examples, and notes and references.</p>
<h3 id="keep-it-simple">Keep it simple</h3>
<blockquote>
<p>We all know that moment.  Huzzah!  Ten lines of code condensed
into a one-liner.  It&rsquo;s a divine piece of art, beautifully compact.</p>
<p>And, yet, so utterly incomprehensible to future you.</p>
<p>I don&rsquo;t know where the following idea originated, but Robert Martin
states it well in &ldquo;Clean Code&rdquo;.  He writes: “Indeed, the ratio of
time spent reading versus writing is well over 10 to 1. We are
constantly reading old code as part of the effort to write new
code. &hellip;[Therefore,] making it easy to read makes it easier to
write.”</p>
<p>In addition, Martin Fowler wrote: &ldquo;Any fool can write code that a
computer can understand. Good programmers write code that humans can
understand.&rdquo;</p>
</blockquote>
<p>Making code <em>shorter</em> does not necessarily mean making it <em>simpler</em> to
understand.  Strive for clarity of expression, instead.</p>
<p>I&rsquo;ll also note here that object orientation is a great distraction to
new programmers, when functional design would suffice for the majority
of cases.</p>
<h3 id="algorithm-over-optimization">Algorithm over optimization</h3>
<blockquote>
<p>We all know the Donald Knuth quote: &ldquo;Premature optimization is the
root of all evil&rdquo;.</p>
<p>I experienced this first-hand while writing a library to calculate
discrete pulse transforms of images.  I spent weeks on this project,
utilizing every trick in the book: I wrote a library in C, cached
every intermediate calculation, and invented a new sparse
data-structure.  I felt <em>good</em> about this code; it was clever and
fast.</p>
<p>One day, an old professor walked into my office. &ldquo;Oh, by the way,&rdquo; he
said, &ldquo;I wrote an implementation of the discrete pulse transform this
weekend.&rdquo;  I ran his code: it executed correctly, and was at least as
fast as mine.  Confused, I examined his work more closely: 80 lines
of pure Python.  No particular optimizations.  Just: the right idea,
aided by the appropriate built-in data structures (priority queues,
in this case).</p>
<p>It turns out the professor was the one who invented the algorithm,
and he knew a thing or two about it. This experience taught me a
valuable lesson: get the <em>execution order</em> right.  You can write
your code in assembler, and your $\mathcal{O}(N^2)$ algorithm still
won&rsquo;t beat $\mathcal{O}(N)$ runtime on a large enough dataset.
Worry about implementing <em>the correct algorithm</em>, instead of
optimizing the wrong one.</p>
</blockquote>
<h3 id="automate-everything">Automate everything</h3>
<p>As far as possible, automate all processes: building of your software,
testing, producing figures for papers, the works.  When you automate a
process, you have one place to go to make a fix that affects all of
your work.  Otherwise, you will be very tempted to only fix the
outputs that urgently require attention.</p>
<p>The Japanese has the practice of Kaizen (改善), or &ldquo;continual
improvement&rdquo;.  Small changes, applied many times over, can result in
great progress.</p>
<p>As an example of a fully automated publication, see <a href="https://github.com/elegant-scipy/elegant-scipy">Elegant SciPy</a>.</p>
<h3 id="be-consistent">Be consistent</h3>
<p>There is no single best way to structure and format code.  Pick a
style you like, and stick to it.  Structure your entire code base the
same way, and ask that collaborators use the same standards.  In the
Python world, we have PEP8; but use whatever your community
recommends.</p>
<h2 id="scholarly-publication">Scholarly publication</h2>
<p>Finally, your scientific code will likely be of better quality if it
gets made public.  Why?  Because if you know your code is going to be
published, you will take better care in its construction,
documentation, and testing.  No one wants to have others look at their
poor quality work!</p>
<p>There are several ways to make code public.  The easiest is to publish
it in a public git repository on, e.g., GitHub or GitLab.  This also
allows external developers to submit changes for your consideration.</p>
<p>If that is not an option, a copy of the software can be uploaded to a
public repository, where it will receive a Digital Object Identifier,
or DOI&mdash;essentially a snapshot, that shows the state of the software
at a specific point in time.</p>
<p>A third option is to simply upload the software to your website.  It&rsquo;s
the way we used to do it, but we now have better mechanisms.</p>
<p>Whichever medium you use, remember to add a license to your software.
Without a license, your software cannot be reused by others.  It is
<em>not</em> simply public domain without a license; quite the contrary.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Scientific software has the potential to change our understanding of
the world.  Discoveries, however, depend on accurate results, which
are more likely to arise from high quality code.  We suggest you write
your code in teams&mdash;it is not only more fun, but likely to be more
widely usable.  At a minimum, ensure that your code is <em>tested</em> and
<em>documented</em>.  Aim for <em>reusability</em>.  Then, <em>publish</em> your work: it will
make science more transparent, and it will make your code better.</p>
<h2 id="notes">Notes</h2>
<p>A friend reviewing my talk pointed me
to
<a href="https://towardsdatascience.com/modernizing-academic-data-science-4213794a278e">this article</a>
by
<a href="https://pbeukema.github.io/">Patrick Beukema</a> that covers similar
ground.  Looks like we&rsquo;re in agreement!</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Gaël Varoquaux, <a href="http://gael-varoquaux.info/programming/beyond-computational-reproducibility-let-us-aim-for-reusability.html">Beyond
Computational Reproducibility, Let Us Aim for Reusability</a>,
IEEE CIS TC Cognitive and Developmental Systems (volume 32, number 2, 2016). <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0020124">Why Most Published Research Findings Are False, https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0020124</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>Jeff Sutherland, Doing Twice the Work in Half the Time, Chapter 3 <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


		<script type="text/javascript">
  var disqus_identifier = "http://stefanv.github.com/blog/2020/08/19/how-to-write-good-scientific-software/";
</script>

<div style="border-top: 0.5px solid #e5e5e5; padding-top: 1em;">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "stefanvdwalt" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

	</div>

	<div class="pagination">
		<a href="/blog/2020/04/28/voice-capture-org-tasks-on-android/" class="left arrow">&#8592;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2020-08-19 13:40:00.205198174 -0700 PDT m=&#43;0.102397125">2020</time> . Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
